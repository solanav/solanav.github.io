<!DOCTYPE html>
<html lang="en">

<head>
  <title> Solanav </title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="code.js"></script>

  <link href="style.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Varela&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.5/css/mdb.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">

</head>

<body>
  <div class="jumbotron text-center">
    <h1 class="varela"> M**WARE </h1>
    <p> Personal blog, mainly talking about evil wares and other interesting topics </p>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-lg-3">
        <!-- MEDIA -->
        <h4>Social</h4>
        <ul class="list-group list-group-flush">
          <a href="https://github.com/solanav" class="list-group-item list-group-item-action">
            <i class="fab fa-github pr-1"></i>
            <span>Github</span>
          </a>
          <a href="https://twitter.com/3os76dou4hpp" class="list-group-item list-group-item-action">
            <i class="fab fa-twitter pr-1"></i>
            <span>Twitter</span>
          </a>
          <button onClick="copy_to_clipboard()" type="button" class="list-group-item list-group-item-action">
            <i class="fas fa-envelope pr-1"></i>
            <span id="email_button_message">Email</span>
          </button>
        </ul>

        <!-- INDEX TABLE -->
        <br>
        <h4>Posts</h4>
        <ul class="list-group list-group-flush">
          <button onclick="openPost(event, '6')" type="button" class="list-group-item list-group-item-action">
            <span id="email_button_message">Tricking AI Dungeon</span>
          </button>
          <button onclick="openPost(event, '5')" type="button" class="list-group-item list-group-item-action">
            <span id="email_button_message">Balsamiq 4 crack</span>
          </button>
          <button onclick="openPost(event, '4')" type="button" class="list-group-item list-group-item-action">
            <span id="email_button_message">HA Load balancing</span>
          </button>
          <button onclick="openPost(event, '3')" type="button" class="list-group-item list-group-item-action">
            <span id="email_button_message">Fast data structures</span>
          </button>
          <button onclick="openPost(event, '2')" type="button" class="list-group-item list-group-item-action">
            <span id="email_button_message">P2P Comms security</span>
          </button>
          <button onclick="openPost(event, '1')" type="button" class="list-group-item list-group-item-action">
            <span id="email_button_message">P2P Trust issues</span>
          </button>
        </ul>
        <br>

      </div>
      <div class="col-lg-9">

        <!-- BLOG POST 6 -->
        <div id="6" class="tabcontent" style="display: block">
          <h3 id="aidungeon">Tricking AI Dungeon</h3>
          <p><i>[39/07/20]</i></p>
          <p>&#8195;I wanted a GPT-3 API key so I could do some text generation to imitate imageboard posts but it doesn't seem like I'm getting one anytime soon.</p>
          <p>&#8195;AI Dungeon is a text game that uses GPT-2 or GPT-3 to complete stories. Turns out, its trivial to "retrain" AI Dungeon to generate anything we want and use it as an alternative to the official API. You can just create a new story,
          choose "Custom" story so you can write the intro and then write some examples for the AI of what you want.</p>
          <p>&#8195;To test it I donwloaded some random titles and comments from <a href="reddit.com/r/Bad_Cop_No_Donut">Bad_Cop_No_Donut</a> and formatted them with INPUT/OUTPUT labels.</p>
          <p>&#8195;<a href="https://pastebin.com/VBMELbmT">Pastebin with some examples of the results</a></p>
          <br><br>
        </div>

        <!-- BLOG POST 5 -->
        <div id="5" class="tabcontent" style="display: block">
          <h3 id="balsamiq4crack">Balsamiq 4 license key crack</h3>
          <p><i>[23/02/20]</i></p>
          <p>&#8195;So the main dll that needs to be checked here is BalsamiqWireframesCommon.dll. It is located in
            C:\Users\{username}\AppData\Local\Programs\Balsamiq\Balsamiq Wireframes 4\
          </p>
          <p>&#8195;After snooping around a bit using the "strings" utility from linux and searching some stuff with
            dotPeek
            I started creating a server with python that could respond to the requests from CheckDesktopKey and
            RegisterDesktopKey.
            This ended up not working because my JSON responses did not fit into what the program understood for some
            reason. So I
            decided to try other ways.
          </p>
          <p>&#8195;Instead of trying to change the response of the server I could just modify how the programs
            interprets
            this
            response. So I kept looking both on the common dll and on the exe and ended up on a function called
            getLicenseStatus
            inside LocalFilesRegistration (in the dll). In this function there are 3 return statements that can easily
            be
            patched
            to always return "ok". This is the only thing we need to get the program to behave as if we had a key.
          </p>
          <p>&#8195;To apply the crack you just need to drag and drop the dll into the Balsamiq Wireframes 4 folder
            (mentioned
            before).
          </p>

          <p>
            Download links:
          </p>
          <ul>
            <li><a href="https://www.jetbrains.com/decompiler/">dotPeek for navigating through .net code</a></li>
            <li><a href="https://github.com/0xd4d/dnSpy">dnSpy for modifying .net code</a></li>
            <li><a href="https://mega.nz/#!qfxnHbKb!juppOB_3UAO7FscU72iplJmxheGkQvZZogYina1KXtg">The cracked .dll
                (mega)</a></li>
            <li><a
                href="magnet:?xt=urn:btih:08cf1f8106ac0b5883690cf11a3ae48e02aa2012&dn=BalsamiqWireframesCommon.dll&tr=udp%3a%2f%2ftracker.coppersurfer.tk%3a6969%2fannounce&tr=udp%3a%2f%2ftracker.leechers-paradise.org%3a6969%2fannounce&tr=udp%3a%2f%2ftracker.opentrackr.org%3a1337%2fannounce&tr=udp%3a%2f%2fp4p.arenabg.com%3a1337%2fannounce&tr=udp%3a%2f%2f9.rarbg.to%3a2710%2fannounce&tr=udp%3a%2f%2f9.rarbg.me%3a2710%2fannounce&tr=udp%3a%2f%2ftracker.internetwarriors.net%3a1337%2fannounce&tr=udp%3a%2f%2fexodus.desync.com%3a6969%2fannounce&tr=udp%3a%2f%2ftracker.tiny-vps.com%3a6969%2fannounce&tr=udp%3a%2f%2ftracker.sbsub.com%3a2710%2fannounce&tr=udp%3a%2f%2fretracker.lanta-net.ru%3a2710%2fannounce&tr=udp%3a%2f%2ftracker.torrent.eu.org%3a451%2fannounce&tr=udp%3a%2f%2ftracker.moeking.me%3a6969%2fannounce&tr=udp%3a%2f%2fopen.stealth.si%3a80%2fannounce&tr=udp%3a%2f%2fopen.demonii.si%3a1337%2fannounce&tr=udp%3a%2f%2fdenis.stalker.upeer.me%3a6969%2fannounce&tr=udp%3a%2f%2ftracker.cyberia.is%3a6969%2fannounce&tr=udp%3a%2f%2fipv4.tracker.harry.lu%3a80%2fannounce&tr=udp%3a%2f%2fzephir.monocul.us%3a6969%2fannounce&tr=udp%3a%2f%2fxxxtor.com%3a2710%2fannounce">The
                cracked .dll (torrent)</a></li>
          </ul>
          <br><br>
        </div>

        <!-- BLOG POST 4 -->
        <div id="4" class="tabcontent">
          <h3 id="load_balancing">High availability load balancing with NGINX and Keepalived</h3>
          <p><i>[21/10/19]</i></p>
          <p>&#8195;Unlike my other posts on the blog, this is going to be more of a tutorial than a rant or whatever I
            usually
            write. I&rsquo;ve been working on a high performance MySQL cluster that needed to be as fast and reliable as
            possible and this setup is what I&rsquo;m going to talk about.</p>

          <p>&#8195;For the setup of a MySQL cluster the easiest solution is to use the gui that they provide on their
            website.
            You can use the windows version or the linux one. Both of them can be found on the downloads page inside a
            zip
            or tar archive, depending on your system. Inside you will find the python tool which requires a couple of
            modules to be installed before using it.</p>

          <p>&#8195;When running the automatic installation you will get to a point where the config has been generated
            already
            and you are able to start the cluster. Before doing that, you have to install the following binaries:</p>


          <ul>
            <li>For the management nodes you will need the ndb_mgm and mysqld binaries.
            </li>
            <li>For the data nodes you will need the ndbmtd binary.
            </li>
          </ul>
          </p>

          <p>&#8195;All these are inside the tar archive I mentioned before. You just have to move them to the location
            you
            specified in the gui. The default is /usr/local/bin. When you are done you should be able to click on start
            and everything should go smoothly.</p>

          <p>&#8195;My setup consisted of four nodes. Two of them are management nodes and the other two are data nodes.
            This
            was automatically decided by the gui and if it&rsquo;s good enough for the auto-installer it&rsquo;s good
            enough for me. What we are looking for now is a high availability load balancer.</p>

          <p>&#8195;A load balancer is a piece of software (or <a
              href="https://www.cisco.com/c/en/us/products/interfaces-modules/ace-application-control-engine-module/index.html">hardware
              sometimes</a></li>) that acts as a proxy between the user and
            your servers. It redirects the user&rsquo;s requests to one of your servers and makes sure that the load is
            well balanced between them. This can be easily done by using tools like HAProxy or NGINX. I decided to
            install
            NGINX because it&rsquo;s very easy to configure. You just have to write something like this inside
            /etc/nginx/nginx.conf.</p>

          <pre><code>stream {
  upstream stream_backend {
    server 192.168.1.50:8081;
    server 192.168.1.51:8081;
  }

  server {
    listen 80;
    proxy_pass stream_backend;
  }
}</code></pre>

          <p>&#8195;I installed NGINX on both management servers, that way I don&rsquo;t need any extra VMs to make the
            load
            balancing work. For that to work I needed to change the servers port so that it won&rsquo;t conflic with the
            load
            balancer one. This covers the load balancing part, what about the high availability?</p>

          <p>&#8195;So inside the two management nodes I have the following:</p>

          <ul>
            <li>MySQL management binary.
            </li>
            <li>MySQL daemon (mysqld).
            </li>
            <li>NGINX
              acting as a load balancer between itself and the other management node
            </li>
          </ul>

          <p>&#8195;Now we need to tackle the high availability. This just means we are going to make the management
            nodes
            redundant. We want to create a shared (virtual) ip that will send you to either management node. For this
            purpose there's multiple tools available like Heartbeat, Pacemaker or Keepalived. I&rsquo;ll just use
            Keepalived because <a
              href="https://serverfault.com/questions/445765/whats-the-difference-between-keepalived-and-corosync-others">reasons</a>.
            After installing Keepalived in both management nodes you&rsquo;ll want to
            configure it with something similar to the following for the master node:</p>

          <pre><code>vrrp_instance VI_1 {
  interface enp0s3
  state MASTER
  virtual_router_id 50
  unicast_src_ip 192.168.1.50
  unicast_peer {
    192.168.1.51
  }
  priority 101
  virtual_ipaddress {
    192.168.1.99/24 dev enp0s3
  }
}</code></pre>

          <p>And this for the backup node:</p>

          <pre><code>vrrp_instance VI_1 {
  interface enp0s3
  state BACKUP
  virtual_router_id 50
  unicast_src_ip 192.168.1.50
  unicast_peer {
    192.168.1.51
  }
  priority 100
  virtual_ipaddress {
    192.168.1.99/24 dev enp0s3
  }
}</code></pre>

          <p>&#8195;In the example, 192.168.1.50 is the master node and 192.168.1.51 is the backup one. Once this is
            setup
            and
            you&rsquo;ve restarted NGINX and Keepalived with systemctl restart, everything should be working ok. You
            should probably add check scripts to Keepalived so that it knows when a node is down. In my example
            configuration the virtual ip is 192.168.1.99. From there you can access your services as if they were one,
            even if one of your management nodes is down.</p>
          <br>
          <br>
        </div>

        <!-- BLOG POST 3 -->
        <div id="3" class="tabcontent">
          <h3 id="data_structures">FAST DATA STRUCTURE FOR UDP SERVER</h3>
          <p><i>[25/07/19]</i></p>
          &#8195;Back at it again, now with some more basic albeit also more boring stuff. I want to talk about data
          structures
          because that’s the problem I have faced this week.<br>
          <br>
          &#8195;My communication protocol has two parts: an active one that lets you send messages when you call its
          functions
          and a reactive one which only receives messages and reacts to them. Each of these parts is running on a
          different thread. This seemed OK until I started to think about latency and how to calculate it.<br>
          <br>
          &#8195;To calculate latency I just send a ping, wait for the other computer to respond with a pong and
          calculate
          the
          time difference between these two. But because these two are in different threads I need a way for the active
          functions to know when the response has arrived. My first idea was to create a list of the last 128 datagrams
          (that’s how UDP messages are called) that we receive. Then the active part can send a ping and look through
          this
          list of datagrams until either it finds what it wants or times out. This is a bad solution because:<br>
          <br>
          <ol>
            <li>You have to iterate through the list constantly, wasting CPU cycles.
            </li>
            <li>If you want to read this list (which is going to be in shared memory) you need to block it with a
              semaphore,
              and this is going to slow down the reactive part.
            </li>
            <li>It requires luck. We don’t really know when it’s going to arrive or if it is going to arrive.
            </li>
          </ol>
          <br>
          &#8195;So after thinking a bit about this I came up with my (for now) final solution. I created a request list
          on the
          shared memory. This request list contains a number of datagrams with a timestamp and other data I require. The
          active part publishes a request like “I’m expecting a pong from 23.214.223.198”. The handlers from the
          reactive
          part look in the request list every time the receive a response-type message and if they find the
          corresponding
          ping to a pong for example, they do whatever they have to with that data. To make this lookup as fast as
          possible I do a couple of things.<br>
          <br>
          &#8195;First, handlers only look in the list for some messages. For example if you receive a pong you will
          have
          to look
          in the request list to check if you had requested this pong. But if you receive a ping, you can be sure you
          have
          not requested this.<br>
          <br>
          &#8195;Second, when I do look in the request list I need to do it fast so I need a good data structure. I
          wanted
          to keep them sorted by time of arrival. When I go check for a request I want to see the oldest requests first.
          But I also want to use a simple array, no allocation of memory. I also don’t want to leave empty spaces. A <a
            href="https://www.cs.cmu.edu/~adamchik/15-121/lectures/Linked%20Lists/linked%20lists.html">linked list</a>
          seems like a good enough solution to this. So I implemented a double-linked list (so I can traverse it both
          ways) inside a list of size 128. When you add a new datagram to the list you just add it to the first empty
          space you can find. Then you set the “next” element of the old last to be you. And finally you set yourself as
          the last element.
          <p>
            Interesting links:
          </p>
          <ul>
            <li><a href="http://www.kegel.com/c10k.html">Async programming in C</a></li>
            <li><a href="http://man7.org/linux/man-pages/man2/eventfd.2.html">FD for events</a></li>
            <li><a href="http://man7.org/linux/man-pages/man7/epoll.7.html">EPoll to use with eventfd</a></li>
          </ul>
          <br>
          <br>
        </div>

        <!-- BLOG POST 2 -->
        <div id="2" class="tabcontent">
          <h3 id="p2p_secure_communication">SECURE COMMS FOR P2P NETWORKS</h3>
          <p><i>[17/07/19]</i></p>
          <p>&#8195;Writing software and writing about writing software.
          </p>
          <p>&#8195;For the remote administration program I'm working on right now, I have to learn about a lot of
            things:
            p2p networks and cryptography for communication, X11 and Wayland for
            interaction with the remote computer and Linux in general.
          </p>
          <p>&#8195;Last post I rambled about my ideas on how to build Liu's p2p network. Now I want
            to talk a bit about the crypto I'm going to use to avoid being <a
              href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">MITMed</a>.
          </p>
          <p>&#8195;My first idea was pretty simple. I would create an RSA keypair and keep the private key on the
            server
            and hardcode the public one on every client. RSA can only encrypt a bit less than the length of the key, so
            if
            my key was 2048 bits I would have a little less than 256 bytes for my packet. I decided that I would better
            use
            a 4096 bit key so that I had a bit more space to send data to the server. With the public key the clients
            have,
            they could send multiple packets encrypted and only the server would be able to decrypt them with the secret
            key.
          </p>
          <p>&#8195;Even though this is possible and sounded ok for small messages, I decided I would need more space to
            send logs and other files. After reading more about RSA I also discovered it's a pretty bad
            idea to use raw RSA for encryption because <a
              href="https://security.stackexchange.com/questions/10949/encryption-should-i-be-using-rsa-or-aes/10952">reasons</a>.
            So I decided to mix RSA (asymmetric encryption) with AES (symmetric encryption). My idea was to use it the
            following way:
          </p>
          <ol>
            <li>The client has the public key and the server has the private one.
            </li>
            <li>The client generates an AES key and ecrypts some data.
            </li>
            <li>The client encrypts the AES key (192 or 256 bits only) with the public RSA key.
            </li>
            <li>The client sends the now encrypted AES key to the server.
            </li>
            <li>The client sends the now encrypted data to the server.
            </li>
            <li>The server decrypts the AES key with the private RSA key.
            </li>
            <li>The server now has the AES key, that lets us decrypt the data sent by the user.
            </li>
          </ol>
          <p>&#8195;This is much better than the first option, because we can now encrypt as much data as we want
            without
            worrying about splitting the files. We can also encrypt big files much faster because RSA is pretty slow.
            This
            technique is also what we use in Liu's encryption plugin to securely encrypt all files in a given computer.
            The plugin encrypts the files with AES and then sends the AES key encrypted with RSA to the server, removing
            then the AES from the client's computer. This way we can remotely defend our data in case of an attack.
          </p>
          <p>&#8195;Even though the protocol seems good, it still lacks more security. The messages sent from the client
            to the server are encrypted but the ones the server sends to the client are only signed. When you sign a
            message, you don't encrypt it. You can verify the message was not tampered with in the middle of your
            connection but people can read whatever you send to clients. So for the protocol to take care of this I need
            the client to generate another RSA keypair. This time, the client will keep the private and send the public
            key
            to the server. This way, both sides of the connection can encrypt the messages with the other's public key
            and
            keep the connection secure.
          </p>
          <p>&#8195;So we can now add as step zero, the exchange of keys, where the client sends the key to the server
            and
            the server saves it with some other info needed to connect with the client like the IP and the port where
            the
            client listens for instructions.
          </p>
          <p>&#8195;I want to end the post by saying all this is a very bad idea, you should never roll your own
            protocol
            or your own crypto unless you really know what you are doing (and I do not). If you want to use UDP like me
            and need secure communication you should use DTLS. It's like SSL or TLS but instead of TCP it uses UDP.</p>

          <p>
            Interesting links:
          </p>
          <ul>
            <li><a href="https://security.stackexchange.com/questions/20803/how-does-ssl-tls-work">TLS explained</a>
            </li>
            <li><a href="https://en.wikipedia.org/wiki/Post-quantum_cryptography">[Unrelated] Quantum computer resistant
                crypto</a></li>
          </ul>
          <br><br>
        </div>

        <!-- BLOG POST 1 -->
        <div id="1" class="tabcontent">
          <h3 id="p2p_rat_network_security">P2P NETWORK SECURITY AND TRUST ISSUES</h3>
          <p><i>[15/07/19]</i></p>
          <p>&#8195;While writing a p2p communication protocol for my current project, I was faced with the problem of
            discovery of peers and their authenticity.</p>

          <p>&#8195;The first security measure is to sign every client or peer that is deployed to the network. The
            server
            has a <a href="https://simple.wikipedia.org/wiki/RSA_algorithm">RSA</a> keypair. It uses the private key to
            sign the IP of the client being installed. The public key of the server is also given to the client for
            verification of the server instructions.<br>
            This seems like a good idea because it prevents a third party to infiltrate the network unless the server
            infects the attackers computer. We also make sure that the instructions from the server are from the server.
          </p>

          <p>&#8195;To allow clients to replicate and install themselves on other computers, we need a way of asking the
            server for a certificate for a given IP. For this to work, the server has to verify that the client asking
            for
            a new certificate is already part of the network. This is problematic because if an attacker gets their
            computer infected, they now can create as many peers as they want.</p>

          <p>&#8195;Instead of trying to keep attackers out of the network, I propose the idea of making every peer pay
            a
            price for getting into the network. The peers should start with an &quot;untrusted&quot; status and become
            &quot;trusted&quot; only after they give the server something we want. This could be a certain amount of
            time
            mining monero for example.<br>
            With this system, the &quot;untrusted&quot; peers cannot get a very limited amount of information from other
            peers. They are able of relaying instructions to other peers. This way, you allow the attacker to get
            information only if they help the network function and they potentially make you some money.</p>

          <p>&#8195;How do we know the state of a peer? This could be fixed in a centralized manner, just by asking the
            server about the peer. This is good if you want to verify peers by making them mine crypto. Peers could send
            their proof of work to the server, the server verifies that it is valid and lists the peer as trusted on a
            database.<br>
            The decentralized solution is to let every peer decide if a new peer is or not trusted. This way, peers will
            only give information to already trusted peers. This would only work if some peers are trusted by default.
            As
            a solution to this, the only peers that start as untrusted would be the ones not directly created by the
            server. So if a peer installs the program on another computer, the new peers is not trusted by anyone. As an
            example, imagine you are a peer from the network. You have in your known peer list an untrusted one. After
            this untrusted peer has sent you 10 instructions from the server and you have verified they have not been
            modified, you can set the status of this peer to trusted.<br>
            A hybrid model would first ask the server if the peer is trusted, and update the local database accordingly.
            When a peer changes the status of another peer to trusted, this would be communicated to the server and when
            the server receives enough of these, it would update the global status of the peer.<br>
            So what is enough peers? We should set a minimum number of peers, but this absolute value is not good. We
            also
            need to check the number of peers that do not trust it. So we need to get the list of connected peers. This
            should be fairly easy using <a
              href="https://medium.com/coinmonks/a-brief-overview-of-kademlia-and-its-use-in-various-decentralized-platforms-da08a7f72b8f">DHT
              and XOR</a> to calculate the distance to peers. The hash of each peer would be the certificate given by
            the
            server. And so you would calculate how many of the neighbours of your peer trust it and judge it that
            way.<br>
          </p>

          <p>
            Interesting links:
          </p>
          <ul>
            <li><a href="https://medium.com/shyft-network-media/understanding-ethereums-p2p-network-86eeaa3345">About
                ethereum p2p network and DHT</a></li>
            <li><a
                href="https://rchain.atlassian.net/wiki/spaces/CORE/pages/15564804/Ethereum+P2P+Node+Discovery+and+Routing">More
                about ethereum</a></li>
            <li><a href="https://www.cse.wustl.edu/~jain/cse571-07/ftp/p2p/">Security for p2p networks</a></li>
            <li><a href="https://www.techrepublic.com/article/security-on-a-peer-to-peer-network/">More security (less
                technical)</a></li>
            <li><a href="http://www.cs.umd.edu/projects/p2prg/p2p-overview.pdf">Interesting paper 1 about security</a>
            </li>
            <li><a href="http://allan.friedmans.org/papers/P2Psecurity.pdf">Interesting paper 2 about security</a></li>
          </ul>
        </div>
        <br><br>

      </div>
    </div>
  </div>

</body>

</html>
